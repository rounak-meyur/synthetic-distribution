# Creating Synthetic Power Distribution Networks from Road Network Infrastructure
## Motivation
Physical inter-dependencies between networked civil infrastructures such as transportation and power system network are well known. In order to analyze complex non-linear co-relations between such networks, datasets pertaining to such real infrastructures are required. Such data are not readily available due to their sensitive nature. The aim of this project is to generate realistic synthetic distribution network for a given geographical region. The generated network is not the actual distribution system but is very similar to the real distribution network. The synthetic network connects high voltage substations to individual residential consumers through primary and secondary distribution networks. The distribution network is generated by solving an optimization problem which minimizes the overall length of network and is subject to the usual structural and power flow constraints. The network generation algorithm is applied to create synthetic distribution networks in Montgomery county of south-west Virginia, USA.
## Datasets used
**Roads** The road network represented in the form of a graph $\mathcal{R}=(\mathcal{V}_\mathcal{R},\mathcal{L}_\mathcal{R})$, where $\mathcal{V}_\mathcal{R}$ and $\mathcal{L}_\mathcal{R}$ are respectively the sets of nodes and links of the network. Each road link $l\in\mathcal{L}_\mathcal{R}$ is represented as an unordered pair of terminal nodes $(u,v)$ with $u,v\in\mathcal{V}_\mathcal{R}$. Each road node has a spatial embedding in form of longitude and latitude. Therefore each node $v\in\mathcal{V}_\mathcal{R}$ can be represented in two dimensional space as $\mathbf{p_v}\in\mathbb{R}^2$. Similarly, a road link $l=(u,v)$ can be represented as a vector $\mathbf{p_u}-\mathbf{p_v}$.
	
**Substations** The set of substations $\mathsf{S}=\{s_1,s_2,\cdots,s_M\}$, where the area consists of $M$ substations and their respective geographical location data. Each substation can be represented by a point in the 2-D space as $\mathbf{p_s}\in\mathbb{R}^2$.
	
**Residences** The set of residential buildings with geographical coordinates $\mathsf{H}=\{h_1,h_2,\cdots,h_N\}$, where the area consists of $N$ home locations. Each residential building can be represented by a point in the 2-D space as $\mathbf{p_h}\in\mathbb{R}^2$.

Accounting for multiple corporate limits in the same county is another important aspect of data collection. For example, in case of the Roanoke county in south-west Virginia, the residential and road network information are divided into Roanoke county, Roanoke City and Salem City. This is shown in the following figure, where each of the data are extracted and combined to analyze the Roanoke county completely.

Dataset 1| Dataset 2 | Dataset 3
:---: | :---: | :---:
![png](src/figs/161-roads-homes.png) | ![png](src/figs/161-770-roads-homes.png) | ![png](src/figs/161-770-775-roads-homes.png)


## Map points in region to network links
This is accomplished using a QD-Tree approach. The primary aim is to reduce the computation time of the entire process. We provide an example to show how the algorithm works. We consider a single residential coordinate and a subset of road links as input data for our example. Our goal is to evaluate the nearest link to this point. We perform the task in four steps which are showed in the following figure.
1. Plot all the road links and the residential point of interest.
2. Draw bounding boxes around each road link and also the residential point.
3. Find the intersections of bounding box of road links with that of residential point.
4. Compute the nearest link among these short-listed links.

Step 0 | Step 1 | Step 2 | Step 3
:---: | :---: | :---: | :---:
![png](src/figs/step0.png) | ![png](src/figs/step1.png) | ![png](src/figs/step2.png) | ![png](src/figs/step3.png)

## Creating the secondary distribution network
Once the home coordinates are mapped to the nearest road network link, the next objective is to create the secondary distribution network which connects the residence coordinates with points on the road link. The first step is to interpolate points along the road network link where local transformers can be placed. An usual engineering practice undertaken by most distribution companies is to place these local transformers at equal distance apart from each other along the link. Let this distance be denoted by $\mathsf{d}$. The following aspects act as constraints while creating the secondary distribution network.
1. Each residential node has to be covered.
2. The transformer nodes can only be root nodes for the network.
3. Each residential node can either have a degree of 1 (leaf node) or 2 (non-leaf node).
4. The maximum number of hops from a transformer node (root node) is $h$.
5. The power balance constraint at every node should be maintained (commodity flow model).
6. There should not be any loops in the network. This is ensured by 
	- the flow constraint since all residences have positive loads and 
	- considering total number of edges to be equal to the number of residences which are also non-root nodes.
The above constraints are formulated as linear constraints in a mixed integer linear programming (MILP) problem. The objective function of the problem is the total length of all edges in the network. 

### Example 1: Straight road link
Mapped Residences | Local Transformers | Secondary Network
:---: | :---: | :---:
![png](src/figs/secnet-org.png) | ![png](src/figs/secnet-base.png) | ![png](src/figs/secnet-out.png)

### Example 2: Straight road link
Mapped Residences | Local Transformers | Secondary Network
:---: | :---: | :---:
![png](src/figs/secnet-side2.png) | ![png](src/figs/secnet-tsfr2.png) | ![png](src/figs/secnet-result2.png)

### Example 3: Curved road link
Mapped Residences | Local Transformers | Secondary Network
:---: | :---: | :---:
![png](src/figs/secnet-side.png) | ![png](src/figs/secnet-tsfr.png) | ![png](src/figs/secnet-result.png)

## Creating the primary distribution network
The goal is to create the primary distribution network which connects the substations to the local transformers. For this purpose, we aggregate the load at residences to the local transformer locations which have been obtained as an output from the preceding step. The objective of the current step is to connect all these local transformer locations to the substation.

One of the challenges is to handle the large size of the network. For each county, there are few tens of thousands of identified transformer locations. Therefore, the first task is to partition the transformer nodes into separate groups/clusters such that each substation serves only the transformers in a given cluster. We assume that the primary network follows the road network, the clusters should remain connected through the road network. Otherwise, we would be left with multiple disconnected components in each cluster. We use a Voronoi clustering based on the shortest network distance in the graph formed by connecting the road network nodes and transformer nodes along it. The following figure shows the Voronoi partitions for the transformer nodes identified in Roanoke county of south-west Virginia. It is evident that the nearest geographically located nodes are not partioned in the same cluster; rather, nearest nodes based on the network distance are clustered.
Base Network | Voronoi Partitioning
:---: | :---:
![png](src/figs/161-voronoi-base.png) | ![png](src/figs/161-voronoi.png)

The first two partitions obtained for two substations are shown in the following inset figures. We aim to solve the optimization problem for such individual partitions.
Partition 1 | Partition 2
:---: | :---:
![png](src/figs/161-voronoi-1.png) | ![png](src/figs/161-voronoi-2.png)

The next task is to connect the transformers in individual partion/cluster. Since we assume that the primary distribution network almost follows the road network and therefore the latter may be used as a proxy network for the former. Hence, the goal of the current step is to select edges along the road network graph such that all local transformer locations along road links are covered. The road network nodes which define the road network graph can be considered to be dummy points with no load, while the transformer locations have aggregated residential load demands. The road network nodes are only required to be covered in order to connect the local transformer points. In other words, the road network nodes cannot be leaf nodes in the created primary network.

Finally, a substation can have multiple feeder lines connecting different local group of residences. This is usual in a rural geographic region where such local groups are distinctly observable. Therefore, the primary network may be created as a forest of trees with the roots connected to the substation though high voltage feeder lines. The trees are rooted at some road network node and covers all the local transformers. This task is shown for a partition of Montgomery county of south-west Virginia. Here we formulate an optimization problem to identify the primary network. Thereafter, we conect it with the associated secondary to obtain the entire network.

Road network | Primary Network | Entire Network
:---: | :---: | :---:
![png](src/figs/24664-master.png) | ![png](src/figs/24664-primary.png) | ![png](src/figs/24664-network.png)

However, the problem arises for large network sizes with more than 1000 transformer and road nodes in a partition. This implies that we need to solve an mixed integer linear program with few thousand binary variables. This, in turn, leads to a large computation time for obtaining small optimality gap using branch and cut method. Therefore, we go for further partitioning of the network into small sub-regions. We take a similar approach as above by partioning based on network distance. However, the Voronoi centers are considered to be the periphery nodes of a subnetwork with more than 1200 nodes. For example, when one of the partitions of a Roanoke county network is further partioned, we obtain the following clusters. The steps of partioning are listed below. 

<img align="right" width="500" height="500" src="src/figs/alg-periphery.png">

- Graph of  7039  is partioned to [1922, 5117]
- Graph of  1922  is partioned to [1651, 4, 267]
- Graph of  1651  is partioned to [771, 880]
- Graph of  5117  is partioned to [2952, 2165]
- Graph of  2952  is partioned to [1649, 1303]
- Graph of  1649  is partioned to [726, 923]
- Graph of  1303  is partioned to [400, 903]
- Graph of  2165  is partioned to [1889, 276]
- Graph of  1889  is partioned to [1098, 791]

Sub-partitioning cluster 1 | Sub-partitioning cluster 2
:---: | :---:
![png](src/figs/121155-master.png) | ![png](src/figs/146410-master.png)

## Validating the created synthetic networks
### Operational Validation
Node Voltages | Edge power flows
:---: | :---:
![png](src/figs/24664-voltage.png) | ![png](src/figs/24664-flows.png)

### Structural Validation
Degree Distribution | Hop Distribution
:---: | :---:
![png](src/figs/24664-degree-dist.png) | ![png](src/figs/24664-hop-dist.png)

### Power Flow throughout the day
Node Voltages | Edge power flows
:---: | :---:
![png](src/figs/24664-voltage.gif) | ![png](src/figs/24664-flows.gif)

## Generating ensemble of synthetic networks 
Cumulative Hop Distribution | Kernel Density Estimates
:---: | :---:
![png](src/figs/24664-hopdist-cluster.png) | ![png](src/figs/24664-hopdist-kde-cluster.png)
